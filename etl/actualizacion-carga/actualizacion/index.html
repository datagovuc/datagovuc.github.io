<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.81.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Actualización de tablas cuando el OWNER existe en MCP_CATALOGO #  Para actualizar los datos de una tabla en particular en la BD Stage-Datagov_Prod, debemos aplicar los siguientes pasos:
Nota Queda pendiente poner este proceso en un proceso unificado, ya sea SP o cualquier otro artefacto.  Paso 1 #  Si, por ejemplo, queremos actualizar las tablas que consume una vista en la BD Sandbox-Datagov_Prod, corremos los siguiente:
SELECT TABLE_SCHEMA , TABLE_NAME FROM INFORMATION_SCHEMA."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Actualización de tablas"><meta property="og:description" content="Actualización de tablas cuando el OWNER existe en MCP_CATALOGO #  Para actualizar los datos de una tabla en particular en la BD Stage-Datagov_Prod, debemos aplicar los siguientes pasos:
Nota Queda pendiente poner este proceso en un proceso unificado, ya sea SP o cualquier otro artefacto.  Paso 1 #  Si, por ejemplo, queremos actualizar las tablas que consume una vista en la BD Sandbox-Datagov_Prod, corremos los siguiente:
SELECT TABLE_SCHEMA , TABLE_NAME FROM INFORMATION_SCHEMA."><meta property="og:type" content="article"><meta property="og:url" content="https://datagovuc.github.io/etl/actualizacion-carga/actualizacion/"><meta property="article:section" content="etl"><title>Actualización de tablas | [ GOB D+I ]</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.bb4068fae5d35122e7452ad3a9d825a65294895db70801a94f2b0764660295d8.css integrity="sha256-u0Bo+uXTUSLnRSrTqdglplKUiV23CAGpTysHZGYCldg="><script defer src=/en.search.min.5ac0f27623b42348ff3a9735f411a322fa800bccba1870565bade908ea62818f.js integrity="sha256-WsDydiO0I0j/Opc19BGjIvqAC8y6GHBWW63pCOpigY8="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>[ GOB D+I ]</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-fa606e3efde5110d75d0a09b9ead6d39 class=toggle>
<label for=section-fa606e3efde5110d75d0a09b9ead6d39 class="flex justify-between"><a href=https://datagovuc.github.io/azure/>AZURE</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/azure/give-access/>Accesos a BD</a></li><li><a href=https://datagovuc.github.io/azure/apisipa/>API SIPA</a></li><li><a href=https://datagovuc.github.io/azure/create-user/>Creación usuarios</a></li></ul></li><li><a href=https://datagovuc.github.io/catalogo-uc/>CATÁLOGO</a><ul></ul></li><li><input type=checkbox id=section-7b1706bfe2ac07274fedc0653c2e509d class=toggle checked>
<label for=section-7b1706bfe2ac07274fedc0653c2e509d class="flex justify-between"><a href=https://datagovuc.github.io/etl/>ETL</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-da45edb9ad62dfc3d81eac2cd3d8f728 class=toggle checked>
<label for=section-da45edb9ad62dfc3d81eac2cd3d8f728 class="flex justify-between"><a>Actualización y Carga</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/etl/actualizacion-carga/actualizacion/ class=active>Actualización de tablas</a></li><li><a href=https://datagovuc.github.io/etl/actualizacion-carga/cargatabla/>Carga de tablas</a></li></ul></li><li><input type=checkbox id=section-1b1a9d67650fa4ce1ad470a45cb5fde4 class=toggle>
<label for=section-1b1a9d67650fa4ce1ad470a45cb5fde4 class="flex justify-between"><a>Mallas</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/etl/mallas/malla-adl/>Malla ADL</a></li><li><a href=https://datagovuc.github.io/etl/mallas/malla-stg/>Malla STG</a></li><li><a href=https://datagovuc.github.io/etl/mallas/malla-sp/>Malla SP</a></li><li><a href=https://datagovuc.github.io/etl/mallas/malla-sbx/>Malla SBX</a></li><li><input type=checkbox id=section-8d37e56937bb4bfaff6d5ac1c1367c3a class=toggle>
<label for=section-8d37e56937bb4bfaff6d5ac1c1367c3a class="flex justify-between"><a>Malla MDM</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/etl/mallas/mallamdm/malla-mdm/>HOW-TO</a></li><li><a href=https://datagovuc.github.io/etl/mallas/mallamdm/pruebamalla/>Prueba malla</a></li></ul></li></ul></li><li><input type=checkbox id=section-404d8c7ce0a7e7573898a51d2c23d0c4 class=toggle>
<label for=section-404d8c7ce0a7e7573898a51d2c23d0c4 class="flex justify-between"><a href=https://datagovuc.github.io/etl/monitoreo/>Monitoreo</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/etl/monitoreo/links-pbi/>Reportes Power BI</a></li></ul></li></ul></li><li><input type=checkbox id=section-304c3b3e57a37bcd413e2e617b29ad62 class=toggle>
<label for=section-304c3b3e57a37bcd413e2e617b29ad62 class="flex justify-between"><a>MDI</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-4aa88a8e1b63e5edba381aaeaa05784f class=toggle>
<label for=section-4aa88a8e1b63e5edba381aaeaa05784f class="flex justify-between"><a>Ficha Academica</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/mdi/ficha-academica/docencia/>Docencia y formación de personas</a></li></ul></li></ul></li><li><input type=checkbox id=section-b8a0889e63e5f81c3d0bd54064ef668c class=toggle>
<label for=section-b8a0889e63e5f81c3d0bd54064ef668c class="flex justify-between"><a href=https://datagovuc.github.io/sistemas/>SISTEMAS</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-769ff70f4e3da7be6898e6554d20eefe class=toggle>
<label for=section-769ff70f4e3da7be6898e6554d20eefe class="flex justify-between"><a href=https://datagovuc.github.io/sistemas/admision/>Admision</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/sistemas/admision/indicadores/>Indicadores</a></li></ul></li><li><input type=checkbox id=section-d761dfde139baece3bcf93a95d0ee141 class=toggle>
<label for=section-d761dfde139baece3bcf93a95d0ee141 class="flex justify-between"><a href=https://datagovuc.github.io/sistemas/banner/>Banner</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/sistemas/banner/metadata/>Metadata</a></li></ul></li><li><input type=checkbox id=section-cdb1a0ce4b230c2a93578a1a6130dd2c class=toggle>
<label for=section-cdb1a0ce4b230c2a93578a1a6130dd2c class="flex justify-between"><a href=https://datagovuc.github.io/sistemas/peoplesoft/>Peoplesoft</a>
<span>▾</span></label><ul></ul></li></ul></li><li><input type=checkbox id=section-1b042e304be954211a030034ce85e02e class=toggle>
<label for=section-1b042e304be954211a030034ce85e02e class="flex justify-between"><a href=https://datagovuc.github.io/sql/>SQL</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-b39dfc0a11a6fbd1c9f42f8f4c8f10c7 class=toggle>
<label for=section-b39dfc0a11a6fbd1c9f42f8f4c8f10c7 class="flex justify-between"><a href=https://datagovuc.github.io/sql/Modelo-DAC/>DAC</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/sql/Modelo-DAC/Configuraci%C3%B3n-DAC/>Configuración DAC</a></li><li><a href=https://datagovuc.github.io/sql/Modelo-DAC/Script_Ejemplo_uso/>Script ejemplo de uso DAC</a></li></ul></li><li><input type=checkbox id=section-fac52381a93b67a47b491d0f59e7a9bf class=toggle>
<label for=section-fac52381a93b67a47b491d0f59e7a9bf class="flex justify-between"><a href=https://datagovuc.github.io/sql/procedures/>SP</a>
<span>▾</span></label><ul></ul></li><li><input type=checkbox id=section-198902c6a8dd459b295a033eaede726f class=toggle>
<label for=section-198902c6a8dd459b295a033eaede726f class="flex justify-between"><a href=https://datagovuc.github.io/sql/queries/>Queries</a>
<span>▾</span></label><ul></ul></li></ul></li><li><input type=checkbox id=section-0b278b34a37d6c2a1ea3108d465cb76a class=toggle>
<label for=section-0b278b34a37d6c2a1ea3108d465cb76a class="flex justify-between"><a>UTILS</a>
<span>▾</span></label><ul><li><a href=https://datagovuc.github.io/utils/columndescription/>Columns Description</a></li><li><a href=https://datagovuc.github.io/utils/columntypes/>Columns Types</a></li><li><a href=https://datagovuc.github.io/utils/mapeofk/>Mapeo de FK</a></li><li><a href=https://datagovuc.github.io/utils/resultjson/>Resultado de query en JSON</a></li><li><a href=https://datagovuc.github.io/utils/rowcount/>Row count</a></li><li><a href=https://datagovuc.github.io/utils/viewtableusage/>Tablas consumidas por una vista</a></li></ul></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Actualización de tablas</strong>
<label for=toc-control></label></div></header><article class=markdown><h1 id=actualización-de-tablas-cuando-el-owner-existe-en-mcp_catalogo><strong>Actualización de tablas cuando el OWNER existe en MCP_CATALOGO</strong>
<a class=anchor href=#actualizaci%c3%b3n-de-tablas-cuando-el-owner-existe-en-mcp_catalogo>#</a></h1><p>Para actualizar los datos de una tabla en particular en la BD <code>Stage-Datagov_Prod</code>, debemos aplicar los siguientes pasos:</p><blockquote class="book-hint info"><strong>Nota</strong>
Queda pendiente poner este proceso en un proceso unificado, ya sea SP o cualquier otro artefacto.</blockquote><h2 id=paso-1><strong>Paso 1</strong>
<a class=anchor href=#paso-1>#</a></h2><p>Si, por ejemplo, queremos actualizar las tablas que consume una vista en la BD <code>Sandbox-Datagov_Prod</code>, corremos los siguiente:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span>
      <span style=color:#000>TABLE_SCHEMA</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>TABLE_NAME</span>
<span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000>INFORMATION_SCHEMA</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>VIEW_TABLE_USAGE</span> 
<span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#000>VIEW_NAME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreVista&gt;&#39;</span>
</code></pre></div><p>Como se aprecia, solo recuperamos los campos que nos interesan, es decir, <code>TABLE_SCHEMA</code> y <code>TABLE_NAME</code>.</p><h2 id=paso-2><strong>Paso 2</strong>
<a class=anchor href=#paso-2>#</a></h2><p>Para asegurarnos que la tabla (o tablas) que queremos actualizar existen, hacemos la siguiente consulta en la BD <code>Stage-Datagov_Prod</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000>MCP</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MCP_CATALOGO</span>
<span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#000>NOMBRE_OWNER</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreOwner&gt;&#39;</span>
<span style=color:#204a87;font-weight:700>AND</span> <span style=color:#000>NOMBRE_TABLA</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreTabla&gt;&#39;</span>
</code></pre></div><p>Haremos el update de la data de las tablas que existan en <code>MCP.MCP_CATALOGO</code>.</p><h2 id=paso-3><strong>Paso 3</strong>
<a class=anchor href=#paso-3>#</a></h2><p>Luego, vemos la última fecha de actualización de las tablas para corroborar la útlima fecha de actualización de las tablas. Para ello corremos el script en la BD <code>Stage-Datagov_Prod</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#ce5c00;font-weight:700>*</span> 
<span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000>MCP</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MCP_FECHA_PROCESO</span> 
<span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#000>ID_CATALOGO</span> <span style=color:#204a87;font-weight:700>IN</span> <span style=color:#000;font-weight:700>(</span>
    <span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#000>ID_CATALOGO</span> 
    <span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000>MCP</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MCP_CATALOGO</span> 
    <span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#000>NOMBRE_TABLA</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreTabla&gt;&#39;</span> 
    <span style=color:#204a87;font-weight:700>AND</span> <span style=color:#000>NOMBRE_OWNER</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreOwner&gt;&#39;</span>
<span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>Donde <code>&lt;nombreTabla> = TABLE_NAME</code> y <code>&lt;nombreOwner> = TABLE_SCHEMA</code> según la información recuperada en el <strong>Paso 0</strong>.</p><h2 id=paso-4><strong>Paso 4</strong>
<a class=anchor href=#paso-4>#</a></h2><p>Luego, seteamos la última y la próxima fecha de actulización de las tablas, tanto para la malla ADL como para la malla STG. Lo siguiente hará que se actualicen los datos en lsa tablas de la BD <code>Stage-Datagov_Prod</code> una vez que se ejecute el pipeline:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>UPDATE</span> <span style=color:#000>MCP</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MCP_FECHA_PROCESO</span> 
<span style=color:#204a87;font-weight:700>SET</span>   <span style=color:#000>FCH_ULT_ACTUALIZACION_ADL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;1900-01-01&#39;</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#000>FCH_PROX_ACTUALIZACION_ADL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#204a87;font-weight:700>CAST</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>GETDATE</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>AS</span> <span style=color:#204a87>DATE</span><span style=color:#000;font-weight:700>))</span> <span style=color:#8f5902;font-style:italic>-- Fecha del día en que hacemos la carga
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>,</span> <span style=color:#000>FCH_ULT_ACTUALIZACION_STG</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;1900-01-01&#39;</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#000>FCH_PROX_ACTUALIZACION_STG</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#204a87;font-weight:700>CAST</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>GETDATE</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>AS</span> <span style=color:#204a87>DATE</span><span style=color:#000;font-weight:700>))</span> <span style=color:#8f5902;font-style:italic>-- Fecha del día en que hacemos la carga    
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#000>ID_CATALOGO</span> <span style=color:#204a87;font-weight:700>IN</span> <span style=color:#000;font-weight:700>(</span>
    <span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#000>ID_CATALOGO</span> 
    <span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000>MCP</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MCP_CATALOGO</span> 
    <span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#000>NOMBRE_TABLA</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreTabla&gt;&#39;</span>
    <span style=color:#204a87;font-weight:700>AND</span> <span style=color:#000>NOMBRE_OWNER</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreOwner&gt;&#39;</span>
<span style=color:#000;font-weight:700>)</span>
</code></pre></div><h2 id=paso-5><strong>Paso 5</strong>
<a class=anchor href=#paso-5>#</a></h2><p>Una vez configurada la fecha de actualización debemos ir al Azure Data Factory de producción y en la <a href="https://adf.azure.com/en-us/authoring/pipeline/Malla%20General?factory=%2Fsubscriptions%2F2e9b712f-7bd2-4ee5-9dba-8da83bc457fb%2FresourceGroups%2Fetl-prod%2Fproviders%2FMicrosoft.DataFactory%2Ffactories%2Fgobdi-df-prod" target=_blank rel=noopener>FASE 2</a> ejecutamos, primero, la malla ADL y luego la malla STG:</p><p><img src=/mallaspipeline.png alt></p><h2 id=paso-6><strong>Paso 6</strong>
<a class=anchor href=#paso-6>#</a></h2><p>Para asegurarnos que las tablas se modicaron en la fecha que hicimos el update corremos lo siguiente en la BD <code>Stage-Datagov_Prod</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#000>create_date</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#000>modify_date</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#000>schema_id</span>
    <span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>SCHEMA_NAME</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>schema_id</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000>sys</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>objects</span>
<span style=color:#204a87;font-weight:700>WHERE</span> <span style=color:#204a87;font-weight:700>SCHEMA_NAME</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>schema_id</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&lt;nombreOwner&gt;&#39;</span>
<span style=color:#204a87;font-weight:700>ORDER</span> <span style=color:#204a87;font-weight:700>BY</span> <span style=color:#000>modify_date</span> <span style=color:#204a87;font-weight:700>DESC</span>
</code></pre></div><p>Para ver el log del proceso corremos:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#204a87;font-weight:700>SELECT</span> <span style=color:#000>TOP</span> <span style=color:#0000cf;font-weight:700>50</span> <span style=color:#ce5c00;font-weight:700>*</span> 
<span style=color:#204a87;font-weight:700>FROM</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>MCP</span><span style=color:#000;font-weight:700>].[</span><span style=color:#000>MCP_LOG_PROCESO_BULK</span><span style=color:#000;font-weight:700>]</span> 
<span style=color:#204a87;font-weight:700>ORDER</span> <span style=color:#204a87;font-weight:700>BY</span> <span style=color:#000>ID_LOG_PROCESO</span> <span style=color:#204a87;font-weight:700>DESC</span>
</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>